<div class="p-6 bg-gray-50 min-h-screen">
  <!-- HEADER -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-3xl font-bold text-gray-800">ğŸšš Historique des Trajets</h2>
      <p class="text-gray-600 text-sm mt-1">GÃ©rez et suivez tous vos trajets</p>
    </div>
    <button
      (click)="openCreateModal()"
      class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition shadow-md flex items-center gap-2"
    >
      <span class="text-xl">â•</span>
      <span>Nouveau Trajet</span>
    </button>
  </div>

  <ng-container *ngIf="trips$ | async as trips; else loadingTrips">
    
    <!-- BARRE D'OUTILS -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        
        <!-- Recherche -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ” Rechercher</label>
          <input
            type="text"
            [(ngModel)]="searchText"
            (ngModelChange)="onSearchChange()"
            placeholder="Ville, immatriculation..."
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- Filtre par statut -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ“Š Statut</label>
          <select
            [(ngModel)]="filterStatus"
            (ngModelChange)="onFilterStatusChange()"
            class="w-full border border-gray-300 rounded-md px-3 py-2"
          >
            <option value="all">Tous</option>
            <option value="pending">En attente</option>
            <option value="in_progress">En cours</option>
            <option value="completed">TerminÃ©</option>
            <option value="cancelled">AnnulÃ©</option>
          </select>
        </div>

        <!-- Actions groupÃ©es -->
        <div class="flex items-end gap-2">
          <button
            (click)="clearFilters()"
            class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition"
            title="RÃ©initialiser les filtres"
          >
            ğŸ”„ Reset
          </button>
          <button
            (click)="exportToCSV()"
            class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition"
            title="Exporter en CSV"
          >
            ğŸ“¥ CSV
          </button>
        </div>
      </div>

      <!-- Actions pour sÃ©lection multiple -->
      <div *ngIf="selectedTrips.size > 0" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md flex justify-between items-center">
        <span class="text-sm text-blue-800 font-medium">
          {{ selectedTrips.size }} trajet(s) sÃ©lectionnÃ©(s)
        </span>
        <button
          (click)="deleteSelected()"
          class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition text-sm"
        >
          ğŸ—‘ï¸ Supprimer la sÃ©lection
        </button>
      </div>
    </div>

    <!-- STATISTIQUES -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">Total</p>
            <p class="text-2xl font-bold text-gray-800">{{ filteredTrips.length }}</p>
          </div>
          <div class="text-4xl">ğŸšš</div>
        </div>
      </div>
      <div class="bg-yellow-50 rounded-lg shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-yellow-700 text-sm">En attente</p>
            <p class="text-2xl font-bold text-yellow-800">{{ countByStatus('pending') }}</p>
          </div>
          <div class="text-4xl">â³</div>
        </div>
      </div>
      <div class="bg-blue-50 rounded-lg shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-700 text-sm">En cours</p>
            <p class="text-2xl font-bold text-blue-800">{{ countByStatus('in_progress') }}</p>
          </div>
          <div class="text-4xl">ğŸš—</div>
        </div>
      </div>
      <div class="bg-green-50 rounded-lg shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-700 text-sm">TerminÃ©s</p>
            <p class="text-2xl font-bold text-green-800">{{ countByStatus('completed') }}</p>
          </div>
          <div class="text-4xl">âœ…</div>
        </div>
      </div>
    </div>

    <!-- TABLEAU -->
    <div class="bg-white rounded-lg shadow-xl overflow-hidden">
      
      <div *ngIf="filteredTrips.length === 0" class="p-12 text-center">
        <div class="text-6xl mb-4">ğŸ“­</div>
        <p class="text-xl text-gray-500 mb-4">Aucun trajet trouvÃ©</p>
        <button
          (click)="openCreateModal()"
          class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
        >
          CrÃ©er votre premier trajet
        </button>
      </div>

      <div *ngIf="filteredTrips.length > 0" class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3">
                <input
                  type="checkbox"
                  [checked]="selectAll"
                  (change)="toggleSelectAll()"
                  class="rounded border-gray-300"
                />
              </th>
              <th 
                (click)="onSortChange('departureCity')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
              >
                Trajet
                <span *ngIf="sortField === 'departureCity'">
                  {{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}
                </span>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Voiture</th>
              <th 
                (click)="onSortChange('estimatedDepartureTime')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
              >
                DÃ©part
                <span *ngIf="sortField === 'estimatedDepartureTime'">
                  {{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}
                </span>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ArrivÃ©e</th>
              <th 
                (click)="onSortChange('status')"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100"
              >
                Statut
                <span *ngIf="sortField === 'status'">
                  {{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}
                </span>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let trip of filteredTrips" class="hover:bg-gray-50 transition">
              <td class="px-4 py-4">
                <input
                  type="checkbox"
                  [checked]="selectedTrips.has(trip.id!)"
                  (change)="toggleSelect(trip.id!)"
                  class="rounded border-gray-300"
                />
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center cursor-pointer" (click)="openDetailsModal(trip)">
                  <div>
                    <div class="text-sm font-medium text-gray-900">
                      ğŸš€ {{ trip.departureCity }} â†’ ğŸ {{ trip.arrivalCity }}
                    </div>
                    <div class="text-xs text-gray-500" *ngIf="trip.steps && trip.steps.length > 0">
                      ğŸ›‘ {{ trip.steps.length }} Ã©tape(s)
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 text-sm text-gray-700">
                <div *ngIf="trip.car">
                  <div class="font-medium">{{ trip.car.make }} {{ trip.car.model }}</div>
                  <div class="text-xs text-gray-500">{{ trip.car.licensePlate }}</div>
                </div>
                <span *ngIf="!trip.car" class="text-gray-400">N/A</span>
              </td>
              <td class="px-6 py-4 text-sm text-gray-600">
                {{ formatDate(trip.estimatedDepartureTime) }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-600">
                {{ formatDate(trip.estimatedArrivalTime) }}
              </td>
              <td class="px-6 py-4">
                <select
                  [value]="trip.status"
                  (change)="quickUpdateStatus(trip, $any($event.target).value)"
                  class="px-3 py-1 rounded-full text-xs font-semibold border"
                  [ngClass]="statusColors[trip.status]"
                >
                  <option value="pending">{{ statusLabels.pending }}</option>
                  <option value="in_progress">{{ statusLabels.in_progress }}</option>
                  <option value="completed">{{ statusLabels.completed }}</option>
                  <option value="cancelled">{{ statusLabels.cancelled }}</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <div class="flex gap-2">
                  <button
                    (click)="openEditModal(trip)"
                    class="text-blue-600 hover:text-blue-800 text-lg"
                    title="Modifier"
                  >
                    âœï¸
                  </button>
                  <button
                    (click)="duplicateTrip(trip)"
                    class="text-green-600 hover:text-green-800 text-lg"
                    title="Dupliquer"
                  >
                    ğŸ“‹
                  </button>
                  <button
                    (click)="deleteTrip(trip)"
                    class="text-red-600 hover:text-red-800 text-lg"
                    title="Supprimer"
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </ng-container>

  <ng-template #loadingTrips>
    <div class="bg-white rounded-lg shadow-xl p-12 text-center">
      <div class="text-6xl mb-4">â³</div>
      <p class="text-xl text-gray-500">Chargement des trajets...</p>
    </div>
  </ng-template>
</div>

<!-- MODAL CRÃ‰ATION -->
<div
  *ngIf="showCreateModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
  (click)="closeCreateModal()"
>
  <div
    class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-gray-800">â• Nouveau Trajet</h3>
        <button
          (click)="closeCreateModal()"
          class="text-gray-500 hover:text-gray-700 text-3xl leading-none"
        >
          âœ•
        </button>
      </div>

      <form [formGroup]="createForm" (ngSubmit)="createTrip()" class="space-y-5">
        <!-- Voiture -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            ğŸš— Voiture <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="carId"
            class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500"
          >
            <option value="" disabled>SÃ©lectionner</option>
            <ng-container *ngIf="availableCars$ | async as cars">
              <option *ngFor="let car of cars" [value]="car.id">
                {{ car.make }} {{ car.model }} ({{ car.licensePlate }})
              </option>
            </ng-container>
          </select>
        </div>

        <!-- Villes -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              ğŸš€ Ville de DÃ©part <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              formControlName="departureCity"
              class="w-full border border-gray-300 rounded-md p-2"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              ğŸ Ville d'ArrivÃ©e <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              formControlName="arrivalCity"
              class="w-full border border-gray-300 rounded-md p-2"
            />
          </div>
        </div>

        <!-- Dates -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              â° DÃ©part <span class="text-red-500">*</span>
            </label>
            <input
              type="datetime-local"
              formControlName="estimatedDepartureTime"
              class="w-full border border-gray-300 rounded-md p-2"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              â±ï¸ ArrivÃ©e <span class="text-red-500">*</span>
            </label>
            <input
              type="datetime-local"
              formControlName="estimatedArrivalTime"
              class="w-full border border-gray-300 rounded-md p-2"
            />
          </div>
        </div>

        <!-- Boutons -->
        <div class="flex gap-3 pt-4">
          <button
            type="submit"
            [disabled]="createForm.invalid || loading"
            class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 font-semibold transition"
          >
            <span *ngIf="!loading">âœ… Enregistrer</span>
            <span *ngIf="loading">â³ Enregistrement...</span>
          </button>
          <button
            type="button"
            (click)="closeCreateModal()"
            [disabled]="loading"
            class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:bg-gray-400 font-semibold transition"
          >
            âŒ Annuler
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- MODALS D'Ã‰DITION / DÃ‰TAILS (inchangÃ©s, dÃ©jÃ  prÃ©sents dans ton code prÃ©cÃ©dent) -->
