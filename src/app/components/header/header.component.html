<ng-container *ngIf="user$ | async as user">
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer" routerLink="/collaborations/demandes">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-sm">C</div>
            <span class="hidden md:block text-xl font-bold text-blue-900 tracking-tight">ColisShare</span>
          </div>
          
          <nav class="hidden md:ml-8 md:flex md:space-x-6">
            <a routerLink="/collaborations/demandes" 
               routerLinkActive="text-blue-600 border-b-2 border-blue-600" 
               class="relative border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors">
               ü§ù Collabs
               <ng-container *ngIf="collabCount$ | async as count">
                 <span *ngIf="count > 0" class="absolute -top-1 -right-3 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm animate-bounce">
                   {{ count }}
                 </span>
               </ng-container>
            </a>
            
            <a routerLink="/trajets/historique" 
               routerLinkActive="text-blue-600 border-b-2 border-blue-600" 
               class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors">
               üìã Historique
            </a>

            <a routerLink="/voitures" 
               routerLinkActive="text-blue-600 border-b-2 border-blue-600" 
               class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors">
               üöó Flotte
            </a>
          </nav>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
          
          <a routerLink="/chat" routerLinkActive="text-blue-600 bg-blue-50" class="relative p-2 rounded-full text-gray-400 hover:text-blue-600 hover:bg-gray-50 transition-all group">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
            </svg>
            <ng-container *ngIf="chatCount$ | async as count">
               <span *ngIf="count > 0" class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
            </ng-container>
          </a>

          <div class="flex items-center gap-3 pl-2 border-l border-gray-200">
            
            <div class="flex flex-col items-end text-right">
              <span class="text-sm font-semibold text-gray-900 hidden sm:block">{{ user.displayName }}</span>
              <span class="text-xs text-gray-500 truncate max-w-[140px] sm:max-w-[200px]">{{ user.email }}</span>
            </div>
            
            <div class="h-8 w-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold border border-blue-200 text-sm shadow-sm">
              {{ user.displayName?.charAt(0)?.toUpperCase() || 'U' }}
            </div>

            <button (click)="logout()" class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-all" title="D√©connexion">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <div class="md:hidden py-2 border-t border-gray-100 grid grid-cols-4 gap-1 text-center text-[10px] sm:text-xs font-medium text-gray-500">
        <a routerLink="/collaborations/demandes" routerLinkActive="text-blue-600 bg-blue-50 rounded-lg" class="relative flex flex-col items-center p-2 gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
          Collabs
          <ng-container *ngIf="collabCount$ | async as count">
             <span *ngIf="count > 0" class="absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
          </ng-container>
        </a>

        <a routerLink="/voitures" routerLinkActive="text-blue-600 bg-blue-50 rounded-lg" class="flex flex-col items-center p-2 gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
          Autos
        </a>

        <a routerLink="/trajets/historique" routerLinkActive="text-blue-600 bg-blue-50 rounded-lg" class="flex flex-col items-center p-2 gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
          Histo
        </a>

        <a routerLink="/chat" routerLinkActive="text-blue-600 bg-blue-50 rounded-lg" class="relative flex flex-col items-center p-2 gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
          Chat
          <ng-container *ngIf="chatCount$ | async as count">
             <span *ngIf="count > 0" class="absolute top-1 right-4 w-2 h-2 bg-red-500 rounded-full"></span>
          </ng-container>
        </a>
      </div>
    </div>
  </header>
</ng-container>
